function media_field_formatter_view(a,b,c,d,e,f,g){try{var h={};for(var i in f)if(f.hasOwnProperty(i)){var j=f[i];switch(g.type){case"file_rendered":h[i]={item:j},h[i].theme="media_file_rendered";break;default:console.log("media_field_formatter_view() - unsupported display type: "+g.type)}}return h}catch(k){console.log("media_field_formatter_view - "+k)}}function media_field_widget_form(a,b,c,d,e,f,g,h){try{f[g].type="hidden";var i=[];d.settings.file_extensions.split(/[ ,]+/).forEach(function(a){switch(a){case"jpg":i.push(MEDIA_TYPES.IMAGE);break;case"mp4":i.push(MEDIA_TYPES.VIDEO);break;case"mp3":i.push(MEDIA_TYPES.AUDIO)}});var j="";void 0!==f[g].item&&f[g].item.fid&&(f[g].value=f[g].item.fid,j=theme("media_file_rendered",{item:f[g].item}),j+=media_remove_button({attributes:{"data-input_id":f[g].id,"data-element_id":h.id,"data-langcode":e,"data-cardinality":c.cardinality}}));var k=media_field_widget_media_containter_id(f[g].id),l='<div id="'+k+'"><div id="'+k+'-field-msg"></div><div id="'+k+'-field">'+j+"</div></div>";parseInt(g)+1==c.cardinality&&(l+='<div id="'+h.id+'-upload-button">'+media_upload_button({media_types:i,attributes:{"data-element_id":h.id,"data-langcode":e,"data-cardinality":c.cardinality}})+"</div>",l+='<script type="text/javascript">_media_field_widget_form_visibility(\''+h.id+"' , '"+e+"' , '"+c.cardinality+"');<\/script>"),f[g].children?f[g].children.push({markup:l}):f[g].children=[{markup:l}]}catch(m){console.log("media_field_widget_form - "+m)}}function _media_field_widget_form_visibility(a,b,c){$("#"+a+"-upload-button").hide();for(var d=0;d<c;d++){var e=a+"-"+b+"-"+d+"-value";if(empty($("#"+e).val())){$("#"+a+"-upload-button").show();break}}}function media_remove_button(a){try{var b="";return a.attributes.onclick="media_remove_pressed(this);",b+=theme("media_remove_button",{attributes:a.attributes})}catch(c){console.log("media_remove_button - "+c)}}function media_upload_button(a){try{var b="";return a.attributes.onclick="media_upload_pressed(this);",a.media_types.forEach(function(c){b+=theme("media_button",{type:c,attributes:a.attributes})}),b}catch(c){console.log("media_buttons - "+c)}}function media_upload(a,b){function c(a,b){return{quality:drupalgap.settings.camera.quality?drupalgap.settings.camera.quality:50,sourceType:a,destinationType:Camera.DestinationType.FILE_URI,mediaType:b,targetWidth:drupalgap.settings.camera.targetWidth?drupalgap.settings.camera.targetWidth:1024,targetHeight:drupalgap.settings.camera.targetHeight?drupalgap.settings.camera.targetHeight:1024,saveToPhotoAlbum:a!=Camera.PictureSourceType.PHOTOLIBRARY}}function d(a){var b=encodeURI(Drupal.settings.site_path+"/"+Drupal.settings.endpoint+"/file/create_raw"),c={"X-CSRF-Token":Drupal.sessid};fileURI=a.shift();var e=new FileUploadOptions;e.fileKey="files[file_1]",e.fileName=fileURI.substr(fileURI.lastIndexOf("/")+1).split("?")[0],e.headers=c;var f=new FileTransfer;f.onprogress=function(a){if(a.lengthComputable){var b=Math.round(100*a.loaded/a.total);$(".ui-loader h1").replaceWith("<h1>"+t("Uploading")+" "+b+"%</h1>")}},drupalgap.loader="uploading",drupalgap_loading_message_show(),f.upload(fileURI,b,function(b){var c=$.parseJSON(b.response),e=c[0].fid;1==i?$("input#"+k).val(e):"multiple_file"==j?$("input#"+k).val($("input#"+k).val()+e+","):($("input#"+k).val(e),$("."+drupalgap_form_get_element_container_class(name).replace(/\s+/g,".")+" .description").remove()),_media_field_widget_form_visibility(g,h,i),a.length>0?d(a):drupalgap_loading_message_hide()},function(a){drupalgap_loading_message_hide(),console.log("upload error source "+a.source),console.log("upload error target "+a.target)},e)}function e(a){var c=[];console.log("get_media_success - %o:",a),Array.isArray(a)?a.forEach(function(b){void 0!=b.fullPath?c.push(a[0].fullPath):c.push(b)}):c.push(a);var e="";c.forEach(function(a){switch(o){case MEDIA_TYPES.IMAGE:e+="<img src='"+a+"'>";break;case MEDIA_TYPES.VIDEO:if(e+="<video  style='max-width:100%;' controls preload='metadata' webkit-playsinline=webkit-playsinline' playsinline><source src='"+a+"'></video>",b==MEDIA_ACTIONS.VIDEO_RECORD)try{LibraryHelper.saveVideoToLibrary({},f,a,"")}catch(c){console.log("get_media_success - error: %o",c)}break;case MEDIA_TYPES.AUDIO:e="<audio style='max-width:100%;' controls preload='metadata'><source src='"+a+"'></audio>"}}),e+=media_remove_button({attributes:{"data-input_id":k,"data-element_id":g,"data-langcode":h,"data-cardinality":i}}),e+='<script type="text/javascript">$(\'a[data-input_id='+k+"').buttonMarkup();<\/script>",$("#"+media_field_widget_media_containter_id(k)+"-field").html(e),scrollToElement("#"+g+"-upload-button",500,-40),d(c)}function f(a){console.log("media_upload - error: %o"+a)}try{for(var g=$(a).data("element_id"),h=$(a).data("langcode"),i=$(a).data("cardinality"),j=$(a).data("webform_component_type"),k="",l=0;l<i;l++){var m=g+"-"+h+"-"+l+"-value";if(empty($("#"+m).val())){k=m;break}}if(empty(k))return;var n={},o="";switch(b){case MEDIA_ACTIONS.IMAGE_UPLOAD:o=MEDIA_TYPES.IMAGE,n=c(Camera.PictureSourceType.PHOTOLIBRARY,Camera.MediaType.PICTURE);break;case MEDIA_ACTIONS.IMAGE_RECORD:o=MEDIA_TYPES.IMAGE,n=c(Camera.PictureSourceType.CAMERA,Camera.MediaType.PICTURE);break;case MEDIA_ACTIONS.VIDEO_UPLOAD:o=MEDIA_TYPES.VIDEO,n=c(Camera.PictureSourceType.PHOTOLIBRARY,Camera.MediaType.VIDEO);break;case MEDIA_ACTIONS.VIDEO_RECORD:o=MEDIA_TYPES.VIDEO,navigator.device.capture.captureVideo(e,f,{limit:1});break;case MEDIA_ACTIONS.AUDIO_RECORD:o=MEDIA_TYPES.AUDIO,navigator.device.capture.captureAudio(e,f,{limit:1})}$.isEmptyObject(n)||navigator.camera.getPicture(e,f,n)}catch(p){console.log("media_upload - "+p)}}function media_remove_pressed(a){try{var b=$(a).data("input_id"),c=media_field_widget_media_containter_id(b),d=$(a).data("element_id"),e=$(a).data("langcode"),f=$(a).data("cardinality");$("input#"+b).val(""),$("#"+c+"-field-msg").empty(),$("#"+c+"-field").empty(),_media_field_widget_form_visibility(d,e,f)}catch(g){console.log("media_remove_pressed - "+g)}}function media_upload_pressed(a){function b(b){if(3!=b){var d="";switch(c){case MEDIA_TYPES.IMAGE:d=2==b?MEDIA_ACTIONS.IMAGE_UPLOAD:MEDIA_ACTIONS.IMAGE_RECORD,media_upload(a,d);break;case MEDIA_TYPES.VIDEO:d=2==b?MEDIA_ACTIONS.VIDEO_UPLOAD:MEDIA_ACTIONS.VIDEO_RECORD,media_upload(a,d)}}}try{var c=$(a).data("media-type"),d="",e="",f=[];switch(c){case MEDIA_TYPES.IMAGE:d=t("Select Image source"),e=t("Upload Image"),f=[t("Camera"),t("Photo Library"),t("Cancel")];break;case MEDIA_TYPES.VIDEO:d=t("Select Video source"),e=t("Upload Video"),f=[t("Camera"),t("Media Library"),t("Cancel")];break;case MEDIA_TYPES.AUDIO:media_upload(a,MEDIA_ACTIONS.AUDIO_RECORD)}d&&navigator.notification.confirm(d,b,e,f)}catch(g){console.log("media_upload_pressed - "+g)}}function file_assemble_form_state_into_field(a,b,c,d,e,f,g,h){try{return h.value="fid",c}catch(i){console.log("file_assemble_form_state_into_field - "+i)}}function media_field_widget_media_containter_id(a){return a+"-media"}function image_field_widget_form(a,b,c,d,e,f,g,h){try{media_field_widget_form(a,b,c,d,e,f,g,h)}catch(i){console.log("image_field_widget_form - "+i)}}function file_field_widget_form(a,b,c,d,e,f,g,h){try{media_field_widget_form(a,b,c,d,e,f,g,h)}catch(i){console.log("file_field_widget_form - "+i)}}function theme_media_file_rendered(a){try{var b=a.item;switch(b.filemime){case"application/pdf":return bl(b.filename,drupalgap_image_path(b.uri),{InAppBrowser:!0,attributes:{"data-icon":"action"}});default:if(/image\//.test(b.filemime))return theme("image_style",{style_name:"ll_media_default",path:b.uri});if(/video\//.test(b.filemime))return theme("video",{path:drupalgap_image_path(b.uri),fid:b.fid,item:b,attributes:{controls:"",class:"media-video",playsinline:"",preload:"metadata","webkit-playsinline":"webkit-playsinline"}});if(/audio\//.test(b.filemime))return theme("audio",{path:drupalgap_image_path(b.uri),attributes:{controls:"",class:"media-audio"}});console.log("theme_media_file_rendered() - unsupported filemime: "+b.filemime)}return""}catch(c){console.log("variables - "+c)}}function theme_media_button(a){try{switch(a.attributes["data-media-type"]=a.type,a.type){case MEDIA_TYPES.IMAGE:a.text=t("Upload Image"),a.attributes["data-icon"]="camera";break;case MEDIA_TYPES.VIDEO:a.text=t("Upload Video"),a.attributes["data-icon"]="video";break;case MEDIA_TYPES.AUDIO:a.text=t("Upload Audio"),a.attributes["data-icon"]="audio"}a.attributes["data-role"]="button",a.attributes.href="#";return"<a "+drupalgap_attributes(a.attributes)+">"+a.text+"</a>"}catch(b){console.log("theme_media_button - "+b)}}function theme_media_remove_button(a){try{a.attributes["data-icon"]="delete",a.attributes["data-iconpos"]="right",a.attributes["data-role"]="button",a.attributes.href="#";return"<a "+drupalgap_attributes(a.attributes)+">"+t("Remove")+"</a>"}catch(b){console.log("theme_media_remove_button - "+b)}}var IMAPICKER_OPTIONS={quality:drupalgap.settings.camera.quality?drupalgap.settings.camera.quality:50,width:drupalgap.settings.camera.targetWidth?drupalgap.settings.camera.targetWidth:1024,height:drupalgap.settings.camera.targetHeight?drupalgap.settings.camera.targetHeight:1024},MEDIA_ACTIONS={IMAGE_UPLOAD:1,IMAGE_RECORD:2,VIDEO_UPLOAD:3,VIDEO_RECORD:4,AUDIO_RECORD:5,PICTURE_MULTIPLE_UPLOAD:6},MEDIA_TYPES={IMAGE:"image",VIDEO:"video",AUDIO:"audio"};